<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Your Wedding Gift</title>

<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="pageout-style.css">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
</head>

<body class="payout-body">

<!-- Background slideshow -->
<div class="payout-slideshow">
  <img src="https://media.istockphoto.com/id/866987706/photo/indian-wedding-hands.jpg?s=612x612&w=0&k=20&c=6L-u9qhFPv9MjDnF4UK4AqjVbDKM4_8Xad72IHhwPZE=" class="payout-slide active">
  <img src="https://img.freepik.com/free-photo/hands-indian-bride-groom-intertwined-together-making-authentic-wedding-ritual_8353-10047.jpg?semt=ais_user_personalization&w=740&q=80" class="payout-slide">
  <img src="https://www.manyavar.com/dw/image/v2/BJZV_PRD/on/demandware.static/-/Library-Sites-ManyavarSharedLibrary/default/dw0651b7ec/Unique%20Wedding%20Ceremony%20Ideas%20in%20an%20Inter-cultural%20Indian%20Wedding_blog%201.jpg" class="payout-slide">
</div>

<!-- Dark overlay -->
<div class="payout-overlay">

  <!-- Message block -->
  <div class="message-block">
    <h1 class="payout-title">With Love & Best Wishes</h1>
    <p class="payout-message">
      Dear <span id="guestName">Guest</span>,  
      thank you for being a part of our special day.
    </p>
    <p class="payout-sub">
      We wish you happiness, love, and beautiful memories always.
    </p>
  </div>

  <!-- Voucher card -->
  <div class="voucher-card">

    <h2 class="voucher-title">Your Gift Card</h2>

    <!-- Mask reveal -->
    <div class="voucher-mask">
      <div class="voucher-details">
        <div class="voucher-row">
          <span class="label">Voucher Code</span>
          <span class="value" id="voucherCode">XXXX-XXXX</span>
        </div>
        <div class="voucher-row">
          <span class="label">PIN</span>
          <span class="value" id="voucherPin">XXXX</span>
        </div>
      </div>
    </div>

    <button class="redeem-btn" onclick="openSteps()">How to Redeem</button>
  </div>

</div>

<!-- Instructions modal -->
<div class="steps-modal hidden" id="stepsModal">
  <div class="steps-card">
    <h3>How to Redeem Your Gift</h3>
    <ol>
      <li>Visit the official gift card website.</li>
      <li>Enter the voucher code exactly as shown.</li>
      <li>Enter the PIN when prompted.</li>
      <li>Confirm and enjoy your gift.</li>
    </ol>
    <button onclick="closeSteps()">Close</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    // 1. Security & Expiry Check
    const authId = localStorage.getItem('auth_session_id');
    const isValidated = localStorage.getItem('otp_validated');
    const sessionExpiry = localStorage.getItem('session_expiry');

    const currentTime = new Date();
    const expiryTime = sessionExpiry ? new Date(sessionExpiry) : null;

    if (!authId || isValidated !== 'true' || !expiryTime || currentTime > expiryTime) {
        localStorage.clear();
        window.location.href = "index.html";
        return;
    }

	startSessionTimer();
    // 2. Initialize Page Content
    initSlideshow();
    initGuestData();
});

function initSlideshow() {
    const slides = document.querySelectorAll(".payout-slide");
    let current = 0;
    setInterval(() => {
        slides[current].classList.remove("active");
        current = (current + 1) % slides.length;
        slides[current].classList.add("active");
    }, 4500);
}

function initGuestData() {
    const storedName = localStorage.getItem("guestName");
    if (storedName) {
        document.getElementById("guestName").innerText = storedName;
    }
    // Replace these with your actual logic to fetch real codes if necessary
    document.getElementById("voucherCode").innerText = "ABCD-1234-WEDS";
    document.getElementById("voucherPin").innerText = "8291";
}

function openSteps(){
  document.getElementById("stepsModal").classList.remove("hidden");
}

function closeSteps(){
  document.getElementById("stepsModal").classList.add("hidden");
}

function startSessionTimer() {
    // Check for existing timer
    if (document.querySelector('.session-timer')) return;

    const timerDiv = document.createElement('div');
    timerDiv.className = 'session-timer';
    timerDiv.innerHTML = `
        <span class="timer-label">Access Expires In:</span>
        <span class="timer-value" id="timeLeft">--:--</span>
    `;
    
    // Attach to body directly
    document.body.appendChild(timerDiv);

    const expiryStr = localStorage.getItem('session_expiry');
    if (!expiryStr) return;

    const expiryTime = new Date(expiryStr).getTime();

    const updateTimer = setInterval(() => {
        const now = new Date().getTime();
        const distance = expiryTime - now;

        if (distance <= 0) {
            clearInterval(updateTimer);
            localStorage.clear();
            window.location.href = "index.html";
            return;
        }

        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        const displayElement = document.getElementById("timeLeft");
        if (displayElement) {
            displayElement.innerText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Warning color
            if (distance < 300000) { // 5 minutes
                displayElement.style.color = "#ff4d4d";
            }
        }
    }, 1000);
}
</script>

</body>
</html>
